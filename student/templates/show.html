{% extends 'index.html' %}

{% block title %}Student Details{% endblock %}

{% block body_block %}
    <script>

    $(document).ready(loaddata());

    function loaddata() {
         $.ajax({
        method:'GET',
        url:'http://127.0.0.1:8000/register_student/',
        data:{
             csrfmiddlewaretoken:$('Input[name=csrfmiddlewaretoken]').val(),
        },
        success: function (data) {
            alert("Done");
            console.log(data);

           for(i in data)
           {

               // console.log(data[i].name);
                $('#table_body').append("<tr><td>"+data[i].roll+"</td><td>"+data[i].name+"</td><td>"+data[i].email+"</td><td>"+data[i].contact+"</td><td><button class='btn btn-danger' value="+ data[i].roll + " onclick='del(this)' >Delete</button></td><td><button class='btn btn-success' value="+ data[i].roll + " onclick='updt(this)' >Update</button></td></tr>");
           }


           // console.log(data);
        },
        error: function (data) {

            alert("Error....\n");
            console.log(data);
        }

    });

    }


    </script>


  <!-- The Modal -->
<div class="modal" id="myModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header bg-info">
          <h4 class="modal-title text-warning"><b>Student Update Form</b></h4>
        <button type="button" class="close" onclick="closefrm()" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
      <form action="#" method="put" id="updfrm">{% csrf_token %}
          <div class="form-group">
                <label>Roll No :</label>
                <input type="text " id="roll" class="form-control" readonly>
            </div>
            <div class="form-group">
                <label>Name :</label>
                <input type="text " id="name" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Email :</label>
                <input type="email " id="email" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Contact :</label>
                <input type="tel" id="contact" maxlength="10" minlength="10" class="form-control" pattern="[0-9]+" required>
            </div>
            <br>
         <button type="button" class="btn btn-danger" style="width: 40%;float: right;" onclick="updatedata()" data-dismiss="modal">Update</button>


      </div>
    </form>

    </div>
  </div>
</div>























<br>
{% csrf_token%}

    <p id="d"></p>
<div id="record">
    <h3 class="text-center"><b>Student Details</b></h3>
<table class="table table-striped">
    <thead>
    <tr><th>Roll No</th><th>Name</th><th>Email_Id</th><th>Contact</th><th>Delete</th><th>Update</th></tr>
    </thead>
    <tbody id="table_body">

    </tbody>
</table>

</div>

<script>

function del(btn) {

    var val=btn.value;
   //$('#frm').preventDefault();

    $.ajax({

       type:'DELETE',
       url:'http://127.0.0.1:8000/register_student/'+val,
       data: {roll:val,
           csrfmiddlewaretoken:$('Input[name=csrfmiddlewaretoken]').val(),
        },
       success:function (data) {
           alert("Done....");
           $('#table_body').empty();
           loaddata();
           console.log(data);
       } ,
        error:function (data) {
            alert("Fail....\n"+data);
           console.log(data);

        }


    });


}

function updt(btn) {


    var val=btn.value;
    alert("Update value = "+val);

   $.ajax({

       type:'GET',
       url:'http://127.0.0.1:8000/register_student/'+val,
       data: {roll:val,
           csrfmiddlewaretoken:$('Input[name=csrfmiddlewaretoken]').val(),
        },
       success:function (data) {
           alert("Done....\n"+data);
           $('#roll').val(data.roll);
           $('#name').val(data.name);
           $('#email').val(data.email);
           $('#contact').val(data.contact);
           $('#myModal').show();
             $('#record').hide();
           //console.log(" name=="+data.name)
          // $('#table_body').empty();
          // loaddata();
           console.log(data);
       } ,
        error:function (data) {
            alert("Fail....\n"+data);
           console.log(data);

        }


    });

}

function updatedata() {

    var pk=$("#roll").val();

     $.ajax({
       type:'PUT',
       url:'http://127.0.0.1:8000/register_student/'+pk,
       data: {name: $("#name").val(),
              email: $("#email").val(),
              contact: $("#contact").val(),
             csrfmiddlewaretoken:$('Input[name=csrfmiddlewaretoken]').val(),
        },
       success:function (data) {
           alert("Record Updated Successfully....\n"+data);
             $('#table_body').empty();
                loaddata();
           $('#myModal').hide();
             $('#record').show();

           console.log(data);
       } ,
        error:function (data) {
            alert("Fail....\n"+data);
           console.log(data);

        }


    });





    //$('#myModal').hide();
    //$('#record').show();

}

function closefrm() {
    $('#myModal').hide();
    $('#record').show();

}

</script>

{% endblock %}